{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNY</title>
       <link rel="icon" href="{% static 'images/logo.jpg' %}" type="image/gif/jpg">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@48,400,0,0" />
    <style>
        /* All general variables are included here */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,500;0,600;0,700;0,800;1,600&display=swap');

        :root {
            --clr-primary: #FF1493;
            --clr-danger: #ff7782;
            --clr-success: #41f1b6;
            --clr-white: #fff;
            --clr-info-dark: #7d8da1;
            --clr-info-light: #dce1eb;
            --clr-dark: #363949;
            --clr-warnig: #ff4edc;
            --clr-light: rgba(132, 139, 200, 0.18);
            --clr-primary-variant: #111e88;
            --clr-dark-variant: #677483;
            --clr-color-background: #f6f6f9;

            --card-border-radius: 2rem;
            --border-radius-1: 0.4rem;
            --border-radius-2: 0.8rem;
            --border-radius-3: 1.2rem;

            --card-padding: 1.8rem;
            --padding-1: 1.2rem;
            --box-shadow: 0 2rem 3rem var(--clr-light);
        }

        /* Dark theme variables for the entire page */
        .dark-theme-variables {
            --clr-color-background: #181a1e;
            --clr-white: #202528;
            --clr-light: rgba(0, 0, 0, 0.4);
            --clr-dark: #edeffd;
            --clr-dark-variant: #677483;
            --box-shadow: 0 2rem 3rem var(--clr-light)
        }

        /* General reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            border: 0;
            text-decoration: none;
            list-style: none;
            appearance: none;
        }

        body {
            width: 100vw;
            height: 100vh;
            font-size: .7rem;
            user-select: none;
            overflow-x: hidden;
            background: var(--clr-color-background);
            font-family: 'Poppins', sans-serif;
            color: var(--clr-dark);
        }

        /* Main container for layout with sidebar, main content, and RIGHT SECTION (only top bar now) */
        .container {
            display: grid;
            width: 96%;
            gap: 1.8rem;
            grid-template-columns: 14rem auto 16rem; /* Still allocates space for 'right' but it's much smaller */
            margin: 0 auto;
        }

        /* Common Typography and Utility Classes */
        a { color: var(--clr-dark); }
        h1 { font-weight: 800; font-size: 2.8rem; }
        h2 { font-size: 1.4rem; }
        h3 { font-size: 0.87; }
        h4 { font-weight: 0.8rem; }
        h5 { font-size: 0.77rem; }
        small { font-size: 0.75rem; }
        .profile-photo img {
            width: 2.8rem;
            height: 2.8rem;
            overflow: hidden;
            border-radius: 50%;
        }
        .text-muted { color: var(--clr-info-dark); }
        p { color: var(--clr-dark-variant); }
        b { color: var(--clr-dark); }
        .primary { color: var(--clr-primary); }
        .success { color: var(--clr-success); }
        .danger { color: var(--clr-danger); }
        .warning { color: var(--clr-warnig); }

        /* Aside (Sidebar) Styles */
        aside {
            height: 100vh;
            background: var(--clr-white); /* Important for dark mode */
            transition: all 0.3s ease;
        }
        aside .top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 1.4rem;
            padding: 0 1.4rem;
        }
        aside .logo {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        aside .logo img {
            width: 2rem;
            height: 2rem;
        }
        aside .top div.close span {
            display: none; /* Hidden on desktop */
        }
        aside .sidebar {
            display: flex;
            flex-direction: column;
            height: 86vh;
            position: relative;
            top: 1rem;
        }
        aside h3 {
            font-weight: 500;
            color: var(--clr-dark);
        }
        aside .sidebar a {
            display: flex;
            color: var(--clr-info-dark);
            margin-left: 2rem;
            gap: 1rem;
            align-items: center;
            height: 3.3rem;
            transition: all .1s ease;
        }
        aside .sidebar a span {
            font-size: 1.6rem;
            transition: all .3s ease-in-out;
        }
        aside .sidebar a:last-child {
            position: absolute;
            bottom: 1rem;
            width: 100%;
        }
        aside .sidebar a.active {
            background-color: var(--clr-light);
            color: var(--clr-primary);
            margin-left: 0;
            border-left: 5px solid var(--clr-primary);
            padding-left: calc(2rem - 5px);
        }
        aside .sidebar a:hover span {
            margin-left: 1rem;
        }
        aside .sidebar a span.msg_count {
            background-color: var(--clr-danger);
            color: var(--clr-white);
            padding: 2px 5px;
            font-size: 11px;
            border-radius: var(--border-radius-1);
        }

        /* Right Section Styles (ONLY Header, Theme Toggler, Profile) */
        .right {
            margin-top: 1.4rem;
            /* No h2, recent_updates, sales-analytics, add_product styles here */
        }
        /* No h2, as analytics/updates are gone */
        .right .top {
            display: flex;
            justify-content: start; /* Changed to start, as there's less content */
            gap: 2rem;
        }
        .right .top button { /* Mobile menu button */
            display: none; /* Hidden on desktop */
        }
        .right .theme-toggler {
            background: var(--clr-white);
            display: flex;
            justify-content: space-between;
            height: 1.6rem;
            width: 4.2rem;
            cursor: pointer;
            border-radius: var(--border-radius-1);
        }
        .right .theme-toggler span {
            font-size: 1.2rem;
            width: 50%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .right .theme-toggler span.active {
            background: var(--clr-primary);
            color: #fff;
        }
        .right .top .profile {
            display: flex;
            gap: 2rem;
            text-align: right;
        }
        .right .info h3 {
            color: var(--clr-dark);
        }
.modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            justify-content: center;
            align-items: center;
            display: flex;
        }

        .modal-content {
            background-color: var(--clr-white);
            padding: 2.5rem;
            border-radius: var(--border-radius-2);
            box-shadow: var(--box-shadow);
            width: 90%;
            max-width: 450px;
            position: relative;
            text-align: center;
        }

        .close-button {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
        }

        .modal-content h2 {
            margin-top: 0;
            margin-bottom: 1.5rem;
            color: var(--clr-dark);
        }

        .modal-content form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .modal-content label {
            text-align: left;
            font-weight: 600;
            color: var(--clr-info-dark);
        }

        .modal-content input[type="password"] {
            width: 100%;
            padding: var(--padding-1);
            border: 1px solid var(--clr-info-light);
            border-radius: var(--border-radius-1);
            background: var(--clr-color-background);
            box-sizing: border-box;
            color: var(--clr-dark);
        }

        .modal-content input[type="password"]:focus {
            outline: none;
            border-color: var(--clr-primary);
        }

        .modal-content button {
            padding: var(--padding-1);
            border: none;
            border-radius: var(--border-radius-1);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .modal-content button[type="submit"] {
            background-color: var(--clr-primary);
            color: var(--clr-white);
        }

        .modal-content button[type="submit"]:hover {
            opacity: 0.9;
        }

        #forgot-password-btn {
            background-color: transparent;
            color: var(--clr-info-dark);
            text-decoration: underline;
        }
        
        #forgot-password-btn:hover {
            color: var(--clr-primary);
        }

        .error-message {
            color: var(--clr-danger);
            text-align: left;
            font-size: 0.9rem;
            margin-top: -0.5rem;
            display: none;
        }
        /* No .item h3 or other .item styles here, as analytics/updates are gone */

        /* Media Queries for Navbar-present Layout (adjusted) */
        @media screen and (max-width:1200px) {
            .container {
                width: 94%;
                grid-template-columns: 7rem auto 14rem; /* Still allocates space for 'right' */
            }
            aside .sidebar h3 {
                display: none;
            }
            aside .sidebar a {
                width: 5.6rem;
            }
            aside .sidebar a:last-child {
                position: relative;
                margin-top: 1.8rem;
            }
        }

        @media screen and (max-width:768px) {
            .container {
                width: 100%;
                grid-template-columns: repeat(1,1fr);
            }
            aside {
                position: fixed;
                width: 18rem;
                z-index: 3;
                height: 100vh;
                background-color: var(--clr-white);
                display: none; /* Hidden by default on mobile */
                left: -110px;
                animation: menuLeft .3s ease forwards;
            }
            @keyframes menuLeft {
                to {
                    left: 0;
                }
            }
            aside .logo h2 {
                display: inline;
            }
            aside .sidebar h3 {
                display: inline;
            }
            aside .sidebar a {
                width: 100%;
                height: 3.4rem;
            }
            aside .top div.close span {
                display: inline;
                position: absolute;
                right: 0;
                margin-right:30px;
                font-size: 35px;
                cursor: pointer;
            }

            .right .top {
                position: fixed;
                top: 0;
                left: 0;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 0 0.8rem;
                background: var(--clr-white);
                height: 4.6rem;
                width: 100%;
                z-index: 2;
                box-shadow: 0 1rem 1rem var(--clr-light);
                margin: 0;
            }
            main { /* This 'main' is a placeholder, its content would come from another template */
                padding-top: 5rem; /* Space for the fixed top bar */
            }
            .right .profile {
                position: absolute;
                left: 70%;
            }
            .right .top .theme-toggler {
                width: 4.4rem;
                position: absolute;
                left: 50%;
            }
            .right .profile .info {
                display: none;
            }
            .right .top button {
                display: inline-block;
                background: transparent;
                cursor: pointer;
                color: var(--clr-dark);
                position: absolute;
                left: 1rem;
            }
            /* Analytics/Updates related media queries are removed */
        }
       
    </style>
</head>
<body>
    <div class="container">
        <aside>
            <div class="top">
                <div class="logo">
                    <h2>DNY</h2>
                </div>
                <div class="close" id="close_btn">
                    <span class="material-symbols-sharp">close</span>
                </div>
            </div>
            <div class="sidebar">
                <a href="{% url 'shop' %}">
                    <span class="material-symbols-sharp">grid_view </span>
                    <h3>Dashboard</h3>
                </a>
                <a href="{% url 'admin-products' %}">
                    <span class="material-symbols-sharp">receipt_long </span>
                    <h3>Products</h3>
                </a>
                                <a href="{% url 'admin_order' %}">
                    <span class="material-symbols-sharp">shopping_cart </span>
                    <h3>Orders</h3>
                </a>
                <a href="{% url 'customer' %}">
                    <span class="material-symbols-sharp">person_outline </span>
                    <h3>Customers</h3>
                </a>
                                <a href="{% url 'admin_notice' %}">
                    <span class="material-symbols-sharp">mail_outline </span>
                    <h3>Notification</h3>

                    {% if unread_notice_count > 0 %}
                    <span class="msg_count">{{ unread_notice_count }}</span>
                    {% endif %}
                </a>
                <a href="{% url 'add_product' %}">
                    <span class="material-symbols-sharp">add </span>
                    <h3>Add Product</h3>
                </a>
                <a href="#" id="change-password-link">
    <span class="material-symbols-sharp">lock</span>
    <h3>Change Password</h3>
</a>
                <a href="{% url 'logout' %}">
                    <span class="material-symbols-sharp">logout </span>
                    <h3>Logout</h3>
                </a>
            </div>
        </aside>

        <main>
 {% block content %}
  {% endblock %}
        </main>

        <div class="right">
            <div class="top">
                <button id="menu_bar">
                    <span class="material-symbols-sharp">menu</span>
                </button>
                <div class="theme-toggler">
                    <span class="material-symbols-sharp active">light_mode</span>
                    <span class="material-symbols-sharp">dark_mode</span>
                </div>
                <div class="profile">
                    <div class="info">
                        <p><b>{{ request.user.customer.last_name|capfirst }}</b></p>
                        <p>Admin</p>
                        <small class="text-muted"></small>
                    </div>
                    <div class="profile-photo">
                        <img src="{{ request.user.customer.image.url }}" alt=""/>
                    </div>
                </div>
            </div>
            </div>
    </div>
  <div id="verify-password-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Verify Current Password</h2>
            <form id="verify-password-form">
                {% csrf_token %}
                <label for="current-password">Current Password:</label>
                <input type="password" id="current-password" name="current_password" required>
                <p id="verify-error-message" class="error-message"></p>
                <button type="submit">Verify</button>
                <a href="{% url 'custom_send_email' %}">
                <button type="button" >Forgot Password?</button>
                </a>
            </form>
        </div>
    </div>

    <div id="change-password-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Change Password</h2>
            <form id="change-password-form">
                {% csrf_token %}
                <label for="new-password">New Password:</label>
                <input type="password" id="new-password" name="new_password" required>
                <p class="password-strength-message" style="color: grey; font-size: 0.8em; text-align: left;"></p>
                <label for="confirm-password">Confirm New Password:</label>
                <input type="password" id="confirm-password" name="confirm_password" required>
                <p id="change-error-message" class="error-message"></p>
                <button type="submit">Save</button>
            </form>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const changePasswordLink = document.getElementById('change-password-link');
        const verifyPasswordModal = document.getElementById('verify-password-modal');
        const changePasswordModal = document.getElementById('change-password-modal');
        const closeButtons = document.querySelectorAll('.close-button');
        const verifyForm = document.getElementById('verify-password-form');
        const changeForm = document.getElementById('change-password-form');
        const verifyErrorMessage = document.getElementById('verify-error-message');
        const changeErrorMessage = document.getElementById('change-error-message');
        const newPasswordInput = document.getElementById('new-password');
        const confirmPasswordInput = document.getElementById('confirm-password');
        const forgotPasswordBtn = document.getElementById('forgot-password-btn');

        // âœ… Use Django template to get the correct URLs
        const verifyPasswordURL = "{% url 'verify_current_password' %}";
        const changePasswordURL = "{% url 'change_password' %}";

        // Initial hidden state
        verifyPasswordModal.style.display = 'none';
        changePasswordModal.style.display = 'none';

        function showModal(modal) {
            modal.style.display = 'flex';
        }

        function hideModal(modal) {
            modal.style.display = 'none';
        }

        changePasswordLink.addEventListener('click', function(e) {
            e.preventDefault();
            showModal(verifyPasswordModal);
        });

        closeButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                hideModal(verifyPasswordModal);
                hideModal(changePasswordModal);
                verifyErrorMessage.style.display = 'none';
                changeErrorMessage.style.display = 'none';
                verifyForm.reset();
                changeForm.reset();
            });
        });

        window.addEventListener('click', function(event) {
            if (event.target === verifyPasswordModal) {
                hideModal(verifyPasswordModal);
                verifyErrorMessage.style.display = 'none';
                verifyForm.reset();
            }
            if (event.target === changePasswordModal) {
                hideModal(changePasswordModal);
                changeErrorMessage.style.display = 'none';
                changeForm.reset();
            }
        });

        forgotPasswordBtn.addEventListener('click', function() {
            alert("Please use the 'Forgot Password' link on the login page to reset your password.");
        });

        verifyForm.addEventListener('submit', function(e) {
            e.preventDefault();

            const currentPassword = document.getElementById('current-password').value;
            const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;

            fetch(verifyPasswordURL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken,
                },
                body: JSON.stringify({ current_password: currentPassword })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    hideModal(verifyPasswordModal);
                    showModal(changePasswordModal);
                    verifyForm.reset();
                } else {
                    verifyErrorMessage.textContent = data.message;
                    verifyErrorMessage.style.display = 'block';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                verifyErrorMessage.textContent = "An unexpected error occurred.";
                verifyErrorMessage.style.display = 'block';
            });
        });

        changeForm.addEventListener('submit', function(e) {
            e.preventDefault();

            const newPassword = newPasswordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;

            const passwordRegex = /^(?=.*\d).{8,}$/;
            if (!passwordRegex.test(newPassword)) {
                changeErrorMessage.textContent = "Password must be at least 8 characters long and contain at least one number.";
                changeErrorMessage.style.display = 'block';
                return;
            }

            if (newPassword !== confirmPassword) {
                changeErrorMessage.textContent = "New passwords do not match.";
                changeErrorMessage.style.display = 'block';
                return;
            }

            fetch(changePasswordURL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken,
                },
                body: JSON.stringify({ new_password: newPassword })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Password changed successfully!');
                    hideModal(changePasswordModal);
                    changeForm.reset();
                } else {
                    changeErrorMessage.textContent = "An error occurred. Please try again.";
                    changeErrorMessage.style.display = 'block';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                changeErrorMessage.textContent = "An unexpected error occurred.";
                changeErrorMessage.style.display = 'block';
            });
        });
    });
</script>

    <script>
        const sideMenu = document.querySelector('aside');
        const menuBtn = document.querySelector('#menu_bar');
        const closeBtn = document.querySelector('#close_btn');
        const themeToggler = document.querySelector('.theme-toggler');

        menuBtn.addEventListener('click', () => {
            sideMenu.style.display = "block";
        });

        closeBtn.addEventListener('click', () => {
            sideMenu.style.display = "none";
        });

        themeToggler.addEventListener('click', () => {
            document.body.classList.toggle('dark-theme-variables');
            themeToggler.querySelector('span:nth-child(1)').classList.toggle('active');
            themeToggler.querySelector('span:nth-child(2)').classList.toggle('active');
        });
    </script>
</body>
</html>
           

       